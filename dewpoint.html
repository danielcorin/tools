<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dew Point Explorer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
:root {
  --bg-primary: #0a0f1a;
  --bg-secondary: #111827;
  --bg-tertiary: #1f2937;
  --bg-card: #172033;
  --accent-primary: #38bdf8;
  --accent-secondary: #818cf8;
  --accent-warm: #fb923c;
  --accent-cool: #22d3ee;
  --text-primary: #f1f5f9;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --border-color: #334155;
  --success: #4ade80;
  --warning: #fbbf24;
  --danger: #f87171;

  --font-sans: 'DM Sans', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;

  --radius-sm: 6px;
  --radius-md: 12px;
  --radius-lg: 20px;

  --shadow-glow: 0 0 40px rgba(56, 189, 248, 0.15);
  --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.3);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  font-size: 16px;
}

body {
  font-family: var(--font-sans);
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
  background-image:
    radial-gradient(ellipse at 20% 0%, rgba(56, 189, 248, 0.08) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 100%, rgba(129, 140, 248, 0.08) 0%, transparent 50%);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

header {
  text-align: center;
  margin-bottom: 3rem;
  padding: 2rem 0;
}

h1 {
  font-size: 3rem;
  font-weight: 600;
  background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 0.5rem;
  letter-spacing: -0.02em;
}

.subtitle {
  color: var(--text-secondary);
  font-size: 1.125rem;
  font-weight: 300;
}

main {
  display: grid;
  gap: 2rem;
}

.controls-panel {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}

.control-group {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  box-shadow: var(--shadow-card);
}

.control-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.control-header label {
  font-weight: 500;
  color: var(--text-secondary);
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.value-display {
  display: flex;
  align-items: baseline;
  gap: 0.25rem;
}

.value-display .value {
  font-family: var(--font-mono);
  font-size: 2rem;
  font-weight: 500;
  color: var(--accent-primary);
}

.value-display .unit {
  font-size: 1rem;
  color: var(--text-secondary);
}

.value-display .secondary-value {
  font-size: 0.875rem;
  color: var(--text-muted);
  margin-left: 0.5rem;
}

.slider-container {
  margin-bottom: 1rem;
}

input[type="range"] {
  width: 100%;
  height: 8px;
  border-radius: 4px;
  background: var(--bg-tertiary);
  appearance: none;
  cursor: pointer;
  outline: none;
}

input[type="range"]::-webkit-slider-thumb {
  appearance: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--accent-primary);
  cursor: grab;
  box-shadow: 0 2px 8px rgba(56, 189, 248, 0.4);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.1);
  box-shadow: 0 2px 16px rgba(56, 189, 248, 0.6);
}

input[type="range"]::-webkit-slider-thumb:active {
  cursor: grabbing;
  transform: scale(0.95);
}

input[type="range"]::-moz-range-thumb {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--accent-primary);
  cursor: grab;
  border: none;
  box-shadow: 0 2px 8px rgba(56, 189, 248, 0.4);
}

.slider-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 0.5rem;
  font-size: 0.75rem;
  color: var(--text-muted);
}

.control-buttons {
  display: flex;
  gap: 0.5rem;
}

.btn-adjust {
  flex: 1;
  padding: 0.625rem 1rem;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-family: var(--font-mono);
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.15s ease;
}

.btn-adjust:hover {
  background: var(--accent-primary);
  border-color: var(--accent-primary);
  color: var(--bg-primary);
}

.btn-adjust:active {
  transform: scale(0.98);
}

.result-panel {
  background: linear-gradient(135deg, var(--bg-card) 0%, rgba(56, 189, 248, 0.05) 100%);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 2rem;
  box-shadow: var(--shadow-card), var(--shadow-glow);
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 2rem;
  align-items: center;
}

.dew-point-display {
  text-align: center;
}

.dew-point-label {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--text-secondary);
  margin-bottom: 0.5rem;
}

.dew-point-value {
  font-family: var(--font-mono);
  font-size: 4rem;
  font-weight: 500;
  color: var(--accent-cool);
  line-height: 1;
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 0.25rem;
}

.dew-unit {
  font-size: 1.5rem;
  color: var(--text-secondary);
}

.dew-point-secondary {
  font-size: 1.125rem;
  color: var(--text-muted);
  margin-top: 0.5rem;
}

.comfort-indicator {
  padding: 1rem;
}

.comfort-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--text-secondary);
  margin-bottom: 0.75rem;
}

.comfort-bar {
  position: relative;
  height: 12px;
  background: linear-gradient(90deg,
    #3b82f6 0%,
    #22c55e 25%,
    #eab308 50%,
    #f97316 75%,
    #ef4444 100%
  );
  border-radius: 6px;
  margin-bottom: 0.5rem;
}

.comfort-zones {
  display: flex;
  justify-content: space-between;
  padding-top: 1rem;
  font-size: 0.625rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.zone {
  color: var(--text-muted);
}

.comfort-marker {
  position: absolute;
  top: -4px;
  width: 20px;
  height: 20px;
  background: var(--text-primary);
  border: 3px solid var(--bg-primary);
  border-radius: 50%;
  transform: translateX(-50%);
  transition: left 0.3s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.comfort-text {
  text-align: center;
  font-weight: 500;
  font-size: 1rem;
  margin-top: 1rem;
  padding: 0.5rem 1rem;
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
}

.spread-display {
  padding: 1rem;
  background: var(--bg-tertiary);
  border-radius: var(--radius-md);
}

.spread-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.75rem;
}

.spread-label {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.spread-value {
  font-family: var(--font-mono);
  font-size: 1.25rem;
  color: var(--accent-warm);
}

.spread-description {
  font-size: 0.875rem;
  color: var(--text-muted);
  line-height: 1.5;
}

.visualization-panel {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 1.5rem;
}

.chart-container {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  box-shadow: var(--shadow-card);
}

.chart-container h3 {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-secondary);
  margin-bottom: 1rem;
  text-align: center;
}

canvas {
  width: 100% !important;
  height: 250px !important;
}

.explanation-panel {
  margin-top: 2rem;
}

.explanation-panel h2 {
  font-size: 1.75rem;
  font-weight: 600;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
}

.explanation-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 1.5rem;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-card);
}

.card-icon {
  font-size: 2rem;
  margin-bottom: 0.75rem;
}

.card h4 {
  font-size: 1rem;
  font-weight: 500;
  margin-bottom: 0.5rem;
  color: var(--accent-primary);
}

.card p {
  font-size: 0.875rem;
  color: var(--text-secondary);
  line-height: 1.6;
}

.formula-box {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 1.5rem;
}

.formula-box h4 {
  font-size: 1rem;
  margin-bottom: 0.75rem;
  color: var(--text-primary);
}

.formula-box p {
  color: var(--text-secondary);
  font-size: 0.875rem;
  margin-bottom: 0.75rem;
}

.formula-box code {
  display: block;
  background: var(--bg-primary);
  border-radius: var(--radius-sm);
  padding: 1rem;
  font-family: var(--font-mono);
  font-size: 0.875rem;
  color: var(--accent-cool);
  line-height: 1.8;
  margin-bottom: 0.75rem;
}

.formula-note {
  font-size: 0.75rem;
  color: var(--text-muted);
}

footer {
  margin-top: 3rem;
  padding: 2rem 0;
  text-align: center;
  border-top: 1px solid var(--border-color);
}

footer p {
  color: var(--text-muted);
  font-size: 0.875rem;
}

@media (max-width: 768px) {
  .container {
    padding: 1rem;
  }

  h1 {
    font-size: 2rem;
  }

  .dew-point-value {
    font-size: 3rem;
  }

  .visualization-panel {
    grid-template-columns: 1fr;
  }

  .chart-container {
    min-width: 0;
  }

  canvas {
    height: 200px !important;
  }
}

.comfort-text.dry { color: #3b82f6; }
.comfort-text.comfortable { color: #22c55e; }
.comfort-text.humid { color: #eab308; }
.comfort-text.very-humid { color: #f97316; }
.comfort-text.oppressive { color: #ef4444; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Dew Point Explorer</h1>
      <p class="subtitle">Understanding how temperature and humidity affect condensation</p>
    </header>

    <main>
      <section class="controls-panel">
        <div class="control-group">
          <div class="control-header">
            <label for="temperature">Air Temperature</label>
            <div class="value-display">
              <span id="temp-value" class="value">20</span>
              <span class="unit">¬∞C</span>
              <span class="secondary-value">(<span id="temp-f">68</span>¬∞F)</span>
            </div>
          </div>
          <div class="slider-container">
            <input type="range" id="temperature" min="-10" max="45" value="20" step="0.5">
            <div class="slider-labels">
              <span>-10¬∞C</span>
              <span>45¬∞C</span>
            </div>
          </div>
          <div class="control-buttons">
            <button class="btn-adjust" data-target="temperature" data-delta="-1">‚àí</button>
            <button class="btn-adjust" data-target="temperature" data-delta="1">+</button>
          </div>
        </div>

        <div class="control-group">
          <div class="control-header">
            <label for="humidity">Relative Humidity</label>
            <div class="value-display">
              <span id="humidity-value" class="value">50</span>
              <span class="unit">%</span>
            </div>
          </div>
          <div class="slider-container">
            <input type="range" id="humidity" min="1" max="100" value="50" step="1">
            <div class="slider-labels">
              <span>1%</span>
              <span>100%</span>
            </div>
          </div>
          <div class="control-buttons">
            <button class="btn-adjust" data-target="humidity" data-delta="-5">‚àí5</button>
            <button class="btn-adjust" data-target="humidity" data-delta="5">+5</button>
          </div>
        </div>
      </section>

      <section class="result-panel">
        <div class="dew-point-display">
          <div class="dew-point-label">Dew Point</div>
          <div class="dew-point-value">
            <span id="dewpoint-value">9.3</span>
            <span class="dew-unit">¬∞C</span>
          </div>
          <div class="dew-point-secondary">
            <span id="dewpoint-f">48.7</span>¬∞F
          </div>
        </div>

        <div class="comfort-indicator">
          <div class="comfort-label">Comfort Level</div>
          <div class="comfort-bar">
            <div class="comfort-zones">
              <span class="zone dry">Dry</span>
              <span class="zone comfortable">Comfortable</span>
              <span class="zone humid">Humid</span>
              <span class="zone oppressive">Oppressive</span>
            </div>
            <div class="comfort-marker" id="comfort-marker"></div>
          </div>
          <div id="comfort-text" class="comfort-text">Comfortable</div>
        </div>

        <div class="spread-display">
          <div class="spread-item">
            <span class="spread-label">Temperature ‚àí Dew Point</span>
            <span class="spread-value" id="spread-value">10.7¬∞C</span>
          </div>
          <div class="spread-description" id="spread-description">
            Air can hold more moisture before condensation occurs.
          </div>
        </div>
      </section>

      <section class="visualization-panel">
        <div class="chart-container">
          <h3>Dew Point vs Humidity at Current Temperature</h3>
          <canvas id="humidity-chart"></canvas>
        </div>
        <div class="chart-container">
          <h3>Dew Point vs Temperature at Current Humidity</h3>
          <canvas id="temperature-chart"></canvas>
        </div>
      </section>

      <section class="explanation-panel">
        <h2>How Dew Point Works</h2>

        <div class="explanation-cards">
          <div class="card">
            <div class="card-icon">üíß</div>
            <h4>What is Dew Point?</h4>
            <p>The dew point is the temperature at which air becomes saturated with water vapor. When air cools to its dew point, water vapor begins to condense into liquid‚Äîforming dew, fog, or clouds.</p>
          </div>

          <div class="card">
            <div class="card-icon">üå°Ô∏è</div>
            <h4>Temperature's Role</h4>
            <p>Warmer air can hold more water vapor. As temperature rises with the same moisture content, relative humidity drops and the dew point stays constant. The gap between temperature and dew point widens.</p>
          </div>

          <div class="card">
            <div class="card-icon">üí®</div>
            <h4>Humidity's Role</h4>
            <p>Higher relative humidity means the air holds more of its maximum possible moisture. At 100% humidity, the dew point equals the air temperature‚Äîcondensation begins immediately.</p>
          </div>

          <div class="card">
            <div class="card-icon">üéØ</div>
            <h4>The Spread Matters</h4>
            <p>The difference between air temperature and dew point tells you how close you are to condensation. A small spread means fog or dew is likely; a large spread means the air feels drier.</p>
          </div>
        </div>

        <div class="formula-box">
          <h4>The Math Behind It</h4>
          <p>This calculator uses the Magnus-Tetens approximation:</p>
          <code>
            Œ≥ = ln(RH/100) + (b √ó T) / (c + T)<br>
            Dew Point = (c √ó Œ≥) / (b ‚àí Œ≥)
          </code>
          <p class="formula-note">Where b ‚âà 17.67, c ‚âà 243.5¬∞C, T is temperature in ¬∞C, and RH is relative humidity in %.</p>
        </div>
      </section>
    </main>

    <footer>
      <p>Explore the relationship between temperature, humidity, and dew point</p>
    </footer>
  </div>

  <script>
const MAGNUS_B = 17.67;
const MAGNUS_C = 243.5;

const temperatureSlider = document.getElementById('temperature');
const humiditySlider = document.getElementById('humidity');
const tempValueEl = document.getElementById('temp-value');
const tempFEl = document.getElementById('temp-f');
const humidityValueEl = document.getElementById('humidity-value');
const dewpointValueEl = document.getElementById('dewpoint-value');
const dewpointFEl = document.getElementById('dewpoint-f');
const comfortMarker = document.getElementById('comfort-marker');
const comfortText = document.getElementById('comfort-text');
const spreadValueEl = document.getElementById('spread-value');
const spreadDescriptionEl = document.getElementById('spread-description');

let humidityChart, temperatureChart;

function calculateDewPoint(tempC, relativeHumidity) {
  if (relativeHumidity <= 0) return -Infinity;
  if (relativeHumidity >= 100) return tempC;

  const gamma = Math.log(relativeHumidity / 100) + (MAGNUS_B * tempC) / (MAGNUS_C + tempC);
  const dewPoint = (MAGNUS_C * gamma) / (MAGNUS_B - gamma);
  return dewPoint;
}

function celsiusToFahrenheit(c) {
  return (c * 9/5) + 32;
}

function getComfortLevel(dewPointC) {
  if (dewPointC < 10) return { level: 'dry', text: 'Dry ‚Äî May feel uncomfortable for some', position: 10 };
  if (dewPointC < 13) return { level: 'comfortable', text: 'Comfortable ‚Äî Pleasant conditions', position: 22 };
  if (dewPointC < 16) return { level: 'comfortable', text: 'Comfortable ‚Äî Ideal for most people', position: 32 };
  if (dewPointC < 18) return { level: 'humid', text: 'Slightly Humid ‚Äî Noticeable moisture', position: 48 };
  if (dewPointC < 21) return { level: 'humid', text: 'Humid ‚Äî Uncomfortable for many', position: 58 };
  if (dewPointC < 24) return { level: 'very-humid', text: 'Very Humid ‚Äî Oppressive', position: 72 };
  return { level: 'oppressive', text: 'Extremely Humid ‚Äî Dangerous heat possible', position: 90 };
}

function getSpreadDescription(spread) {
  if (spread < 2) return 'Fog or dew is very likely. The air is nearly saturated.';
  if (spread < 5) return 'High moisture. Condensation can form on cool surfaces.';
  if (spread < 10) return 'Moderate conditions. Some moisture in the air.';
  if (spread < 15) return 'Air can hold more moisture before condensation occurs.';
  return 'Very dry conditions. Air is far from saturation.';
}

function updateDisplay() {
  const temp = parseFloat(temperatureSlider.value);
  const humidity = parseFloat(humiditySlider.value);
  const dewPoint = calculateDewPoint(temp, humidity);
  const spread = temp - dewPoint;

  tempValueEl.textContent = temp.toFixed(1);
  tempFEl.textContent = celsiusToFahrenheit(temp).toFixed(1);
  humidityValueEl.textContent = humidity;
  dewpointValueEl.textContent = dewPoint.toFixed(1);
  dewpointFEl.textContent = celsiusToFahrenheit(dewPoint).toFixed(1);

  const comfort = getComfortLevel(dewPoint);
  comfortMarker.style.left = `${comfort.position}%`;
  comfortText.textContent = comfort.text;
  comfortText.className = `comfort-text ${comfort.level}`;

  spreadValueEl.textContent = `${spread.toFixed(1)}¬∞C`;
  spreadDescriptionEl.textContent = getSpreadDescription(spread);

  updateCharts(temp, humidity, dewPoint);
}

function createCharts() {
  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    interaction: {
      intersect: false,
      mode: 'index'
    },
    plugins: {
      legend: {
        display: false
      },
      tooltip: {
        backgroundColor: 'rgba(17, 24, 39, 0.95)',
        titleColor: '#f1f5f9',
        bodyColor: '#94a3b8',
        borderColor: '#334155',
        borderWidth: 1,
        cornerRadius: 8,
        padding: 12,
        titleFont: {
          family: "'DM Sans', sans-serif",
          size: 13,
          weight: 500
        },
        bodyFont: {
          family: "'JetBrains Mono', monospace",
          size: 12
        }
      }
    },
    scales: {
      x: {
        grid: {
          color: 'rgba(51, 65, 85, 0.5)',
          drawBorder: false
        },
        ticks: {
          color: '#64748b',
          font: {
            family: "'DM Sans', sans-serif",
            size: 11
          }
        }
      },
      y: {
        grid: {
          color: 'rgba(51, 65, 85, 0.5)',
          drawBorder: false
        },
        ticks: {
          color: '#64748b',
          font: {
            family: "'JetBrains Mono', monospace",
            size: 11
          },
          callback: (value) => `${value}¬∞C`
        }
      }
    }
  };

  const humidityCtx = document.getElementById('humidity-chart').getContext('2d');
  humidityChart = new Chart(humidityCtx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {
          label: 'Dew Point',
          data: [],
          borderColor: '#22d3ee',
          backgroundColor: 'rgba(34, 211, 238, 0.1)',
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointRadius: 0,
          pointHoverRadius: 6,
          pointHoverBackgroundColor: '#22d3ee'
        },
        {
          label: 'Current',
          data: [],
          borderColor: '#fb923c',
          backgroundColor: '#fb923c',
          borderWidth: 0,
          pointRadius: 8,
          pointHoverRadius: 10,
          showLine: false
        }
      ]
    },
    options: {
      ...chartOptions,
      scales: {
        ...chartOptions.scales,
        x: {
          ...chartOptions.scales.x,
          title: {
            display: true,
            text: 'Relative Humidity (%)',
            color: '#64748b',
            font: {
              family: "'DM Sans', sans-serif",
              size: 11
            }
          }
        }
      }
    }
  });

  const temperatureCtx = document.getElementById('temperature-chart').getContext('2d');
  temperatureChart = new Chart(temperatureCtx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {
          label: 'Dew Point',
          data: [],
          borderColor: '#818cf8',
          backgroundColor: 'rgba(129, 140, 248, 0.1)',
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointRadius: 0,
          pointHoverRadius: 6,
          pointHoverBackgroundColor: '#818cf8'
        },
        {
          label: 'Current',
          data: [],
          borderColor: '#fb923c',
          backgroundColor: '#fb923c',
          borderWidth: 0,
          pointRadius: 8,
          pointHoverRadius: 10,
          showLine: false
        }
      ]
    },
    options: {
      ...chartOptions,
      scales: {
        ...chartOptions.scales,
        x: {
          ...chartOptions.scales.x,
          title: {
            display: true,
            text: 'Temperature (¬∞C)',
            color: '#64748b',
            font: {
              family: "'DM Sans', sans-serif",
              size: 11
            }
          }
        }
      }
    }
  });
}

function updateCharts(currentTemp, currentHumidity, currentDewPoint) {
  const humidityLabels = [];
  const humidityData = [];
  for (let rh = 10; rh <= 100; rh += 5) {
    humidityLabels.push(`${rh}%`);
    humidityData.push(calculateDewPoint(currentTemp, rh));
  }

  humidityChart.data.labels = humidityLabels;
  humidityChart.data.datasets[0].data = humidityData;

  const currentHumidityIndex = Math.round((currentHumidity - 10) / 5);
  const humidityMarkerData = new Array(humidityLabels.length).fill(null);
  if (currentHumidityIndex >= 0 && currentHumidityIndex < humidityLabels.length) {
    humidityMarkerData[currentHumidityIndex] = currentDewPoint;
  }
  humidityChart.data.datasets[1].data = humidityMarkerData;
  humidityChart.update('none');

  const tempLabels = [];
  const tempData = [];
  for (let t = -10; t <= 45; t += 5) {
    tempLabels.push(`${t}¬∞C`);
    tempData.push(calculateDewPoint(t, currentHumidity));
  }

  temperatureChart.data.labels = tempLabels;
  temperatureChart.data.datasets[0].data = tempData;

  const currentTempIndex = Math.round((currentTemp + 10) / 5);
  const tempMarkerData = new Array(tempLabels.length).fill(null);
  if (currentTempIndex >= 0 && currentTempIndex < tempLabels.length) {
    tempMarkerData[currentTempIndex] = currentDewPoint;
  }
  temperatureChart.data.datasets[1].data = tempMarkerData;
  temperatureChart.update('none');
}

function setupEventListeners() {
  temperatureSlider.addEventListener('input', updateDisplay);
  humiditySlider.addEventListener('input', updateDisplay);

  document.querySelectorAll('.btn-adjust').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.dataset.target;
      const delta = parseFloat(btn.dataset.delta);
      const slider = document.getElementById(targetId);
      const newValue = parseFloat(slider.value) + delta;
      const min = parseFloat(slider.min);
      const max = parseFloat(slider.max);
      slider.value = Math.max(min, Math.min(max, newValue));
      updateDisplay();
    });
  });

  document.addEventListener('keydown', (e) => {
    if (e.target.tagName === 'INPUT') return;

    switch(e.key) {
      case 'ArrowUp':
        e.preventDefault();
        temperatureSlider.value = Math.min(45, parseFloat(temperatureSlider.value) + 1);
        updateDisplay();
        break;
      case 'ArrowDown':
        e.preventDefault();
        temperatureSlider.value = Math.max(-10, parseFloat(temperatureSlider.value) - 1);
        updateDisplay();
        break;
      case 'ArrowRight':
        e.preventDefault();
        humiditySlider.value = Math.min(100, parseFloat(humiditySlider.value) + 2);
        updateDisplay();
        break;
      case 'ArrowLeft':
        e.preventDefault();
        humiditySlider.value = Math.max(1, parseFloat(humiditySlider.value) - 2);
        updateDisplay();
        break;
    }
  });
}

function loadChartJS() {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js';
    script.onload = resolve;
    script.onerror = reject;
    document.head.appendChild(script);
  });
}

async function init() {
  try {
    await loadChartJS();
    createCharts();
    setupEventListeners();
    updateDisplay();
  } catch (error) {
    console.error('Failed to load Chart.js:', error);
    document.querySelectorAll('.chart-container').forEach(el => {
      el.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 2rem;">Charts unavailable</p>';
    });
    setupEventListeners();
    updateDisplay();
  }
}

init();
  </script>
</body>
</html>
