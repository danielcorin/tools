<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dew Point Explorer | Tools</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/style.css">
  <script>
    // Theme flicker prevention - runs immediately before page renders
    (function () {
      const savedTheme = localStorage.getItem("theme");
      const systemDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const theme = savedTheme || (systemDark ? "dark" : "light");
      document.documentElement.className = theme;
    })();
  </script>
</head>
<body>
  <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
    <span class="theme-icon-light">üåô</span>
    <span class="theme-icon-dark" style="display:none;">‚òÄÔ∏è</span>
  </button>

  <div class="container">
    <nav class="site-nav">
      <a href="/">‚Üê Vibes</a>
    </nav>

    <header>
      <h1>Dew Point Explorer</h1>
      <p class="subtitle">Understanding how temperature and humidity affect condensation</p>
    </header>

    <main>
      <section class="controls-panel">
        <div class="control-group">
          <div class="control-header">
            <label for="temperature">Air Temperature</label>
            <div class="value-display">
              <span id="temp-value" class="value">20</span>
              <span class="unit">¬∞C</span>
              <span class="secondary-value">(<span id="temp-f">68</span>¬∞F)</span>
            </div>
          </div>
          <div class="slider-container">
            <input type="range" id="temperature" min="-10" max="45" value="20" step="0.5">
            <div class="slider-labels">
              <span>-10¬∞C</span>
              <span>45¬∞C</span>
            </div>
          </div>
          <div class="control-buttons">
            <button class="btn-adjust" data-target="temperature" data-delta="-1">‚àí</button>
            <button class="btn-adjust" data-target="temperature" data-delta="1">+</button>
          </div>
        </div>

        <div class="control-group">
          <div class="control-header">
            <label for="humidity">Relative Humidity</label>
            <div class="value-display">
              <span id="humidity-value" class="value">50</span>
              <span class="unit">%</span>
            </div>
          </div>
          <div class="slider-container">
            <input type="range" id="humidity" min="1" max="100" value="50" step="1">
            <div class="slider-labels">
              <span>1%</span>
              <span>100%</span>
            </div>
          </div>
          <div class="control-buttons">
            <button class="btn-adjust" data-target="humidity" data-delta="-5">‚àí5</button>
            <button class="btn-adjust" data-target="humidity" data-delta="5">+5</button>
          </div>
        </div>
      </section>

      <section class="result-panel">
        <div class="dew-point-display">
          <div class="dew-point-label">Dew Point</div>
          <div class="dew-point-value">
            <span id="dewpoint-value">9.3</span>
            <span class="dew-unit">¬∞C</span>
          </div>
          <div class="dew-point-secondary">
            <span id="dewpoint-f">48.7</span>¬∞F
          </div>
        </div>

        <div class="comfort-indicator">
          <div class="comfort-label">Comfort Level</div>
          <div class="comfort-bar">
            <div class="comfort-zones">
              <span class="zone dry">Dry</span>
              <span class="zone comfortable">Comfortable</span>
              <span class="zone humid">Humid</span>
              <span class="zone oppressive">Oppressive</span>
            </div>
            <div class="comfort-marker" id="comfort-marker"></div>
          </div>
          <div id="comfort-text" class="comfort-text">Comfortable</div>
        </div>

        <div class="spread-display">
          <div class="spread-item">
            <span class="spread-label">Temperature ‚àí Dew Point</span>
            <span class="spread-value" id="spread-value">10.7¬∞C</span>
          </div>
          <div class="spread-description" id="spread-description">
            Air can hold more moisture before condensation occurs.
          </div>
        </div>
      </section>

      <section class="visualization-panel">
        <div class="chart-container">
          <h3>Dew Point vs Humidity at Current Temperature</h3>
          <canvas id="humidity-chart"></canvas>
        </div>
        <div class="chart-container">
          <h3>Dew Point vs Temperature at Current Humidity</h3>
          <canvas id="temperature-chart"></canvas>
        </div>
      </section>

      <section class="explanation-panel">
        <h2>How Dew Point Works</h2>

        <div class="explanation-cards">
          <div class="card">
            <div class="card-icon">&#128167;</div>
            <h4>What is Dew Point?</h4>
            <p>The dew point is the temperature at which air becomes saturated with water vapor. When air cools to its dew point, water vapor begins to condense into liquid‚Äîforming dew, fog, or clouds.</p>
          </div>

          <div class="card">
            <div class="card-icon">&#127777;</div>
            <h4>Temperature's Role</h4>
            <p>Warmer air can hold more water vapor. As temperature rises with the same moisture content, relative humidity drops and the dew point stays constant. The gap between temperature and dew point widens.</p>
          </div>

          <div class="card">
            <div class="card-icon">&#128168;</div>
            <h4>Humidity's Role</h4>
            <p>Higher relative humidity means the air holds more of its maximum possible moisture. At 100% humidity, the dew point equals the air temperature‚Äîcondensation begins immediately.</p>
          </div>

          <div class="card">
            <div class="card-icon">&#127919;</div>
            <h4>The Spread Matters</h4>
            <p>The difference between air temperature and dew point tells you how close you are to condensation. A small spread means fog or dew is likely; a large spread means the air feels drier.</p>
          </div>
        </div>

        <div class="formula-box">
          <h4>The Math Behind It</h4>
          <p>This calculator uses the Magnus-Tetens approximation:</p>
          <code>
            Œ≥ = ln(RH/100) + (b √ó T) / (c + T)<br>
            Dew Point = (c √ó Œ≥) / (b ‚àí Œ≥)
          </code>
          <p class="formula-note">Where b ‚âà 17.67, c ‚âà 243.5¬∞C, T is temperature in ¬∞C, and RH is relative humidity in %.</p>
        </div>
      </section>
    </main>

    <footer>
      <p>Explore the relationship between temperature, humidity, and dew point</p>
    </footer>
  </div>

  <script>
// Theme toggle functionality
const themeToggle = document.getElementById('theme-toggle');
const lightIcon = themeToggle.querySelector('.theme-icon-light');
const darkIcon = themeToggle.querySelector('.theme-icon-dark');

function updateThemeIcon() {
  const isDark = document.documentElement.className === 'dark';
  lightIcon.style.display = isDark ? 'none' : 'inline';
  darkIcon.style.display = isDark ? 'inline' : 'none';
}

themeToggle.addEventListener('click', () => {
  const currentTheme = document.documentElement.className;
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  document.documentElement.className = newTheme;
  localStorage.setItem('theme', newTheme);
  updateThemeIcon();
});

updateThemeIcon();

// Dew point calculation
const MAGNUS_B = 17.67;
const MAGNUS_C = 243.5;

const temperatureSlider = document.getElementById('temperature');
const humiditySlider = document.getElementById('humidity');
const tempValueEl = document.getElementById('temp-value');
const tempFEl = document.getElementById('temp-f');
const humidityValueEl = document.getElementById('humidity-value');
const dewpointValueEl = document.getElementById('dewpoint-value');
const dewpointFEl = document.getElementById('dewpoint-f');
const comfortMarker = document.getElementById('comfort-marker');
const comfortText = document.getElementById('comfort-text');
const spreadValueEl = document.getElementById('spread-value');
const spreadDescriptionEl = document.getElementById('spread-description');

let humidityChart, temperatureChart;

function calculateDewPoint(tempC, relativeHumidity) {
  if (relativeHumidity <= 0) return -Infinity;
  if (relativeHumidity >= 100) return tempC;

  const gamma = Math.log(relativeHumidity / 100) + (MAGNUS_B * tempC) / (MAGNUS_C + tempC);
  const dewPoint = (MAGNUS_C * gamma) / (MAGNUS_B - gamma);
  return dewPoint;
}

function celsiusToFahrenheit(c) {
  return (c * 9/5) + 32;
}

function getComfortLevel(dewPointC) {
  if (dewPointC < 10) return { level: 'dry', text: 'Dry ‚Äî May feel uncomfortable for some', position: 10 };
  if (dewPointC < 13) return { level: 'comfortable', text: 'Comfortable ‚Äî Pleasant conditions', position: 22 };
  if (dewPointC < 16) return { level: 'comfortable', text: 'Comfortable ‚Äî Ideal for most people', position: 32 };
  if (dewPointC < 18) return { level: 'humid', text: 'Slightly Humid ‚Äî Noticeable moisture', position: 48 };
  if (dewPointC < 21) return { level: 'humid', text: 'Humid ‚Äî Uncomfortable for many', position: 58 };
  if (dewPointC < 24) return { level: 'very-humid', text: 'Very Humid ‚Äî Oppressive', position: 72 };
  return { level: 'oppressive', text: 'Extremely Humid ‚Äî Dangerous heat possible', position: 90 };
}

function getSpreadDescription(spread) {
  if (spread < 2) return 'Fog or dew is very likely. The air is nearly saturated.';
  if (spread < 5) return 'High moisture. Condensation can form on cool surfaces.';
  if (spread < 10) return 'Moderate conditions. Some moisture in the air.';
  if (spread < 15) return 'Air can hold more moisture before condensation occurs.';
  return 'Very dry conditions. Air is far from saturation.';
}

function updateDisplay() {
  const temp = parseFloat(temperatureSlider.value);
  const humidity = parseFloat(humiditySlider.value);
  const dewPoint = calculateDewPoint(temp, humidity);
  const spread = temp - dewPoint;

  tempValueEl.textContent = temp.toFixed(1);
  tempFEl.textContent = celsiusToFahrenheit(temp).toFixed(1);
  humidityValueEl.textContent = humidity;
  dewpointValueEl.textContent = dewPoint.toFixed(1);
  dewpointFEl.textContent = celsiusToFahrenheit(dewPoint).toFixed(1);

  const comfort = getComfortLevel(dewPoint);
  comfortMarker.style.left = `${comfort.position}%`;
  comfortText.textContent = comfort.text;
  comfortText.className = `comfort-text ${comfort.level}`;

  spreadValueEl.textContent = `${spread.toFixed(1)}¬∞C`;
  spreadDescriptionEl.textContent = getSpreadDescription(spread);

  updateCharts(temp, humidity, dewPoint);
}

function getChartColors() {
  const isDark = document.documentElement.className === 'dark';
  return {
    accent: isDark ? '#4dabf7' : '#0984e3',
    accentSecondary: isDark ? '#a29bfe' : '#6c5ce7',
    text: isDark ? '#a8a8a8' : '#636e72',
    grid: isDark ? 'rgba(74, 74, 74, 0.5)' : 'rgba(180, 180, 180, 0.5)',
    bg: isDark ? 'rgba(28, 27, 23, 0.95)' : 'rgba(244, 241, 228, 0.95)',
    border: isDark ? '#4a4a4a' : '#b4b4b4'
  };
}

function createCharts() {
  const colors = getChartColors();
  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    interaction: {
      intersect: false,
      mode: 'index'
    },
    plugins: {
      legend: {
        display: false
      },
      tooltip: {
        backgroundColor: colors.bg,
        titleColor: colors.text,
        bodyColor: colors.text,
        borderColor: colors.border,
        borderWidth: 1,
        cornerRadius: 8,
        padding: 12,
        titleFont: {
          family: "'Inter', sans-serif",
          size: 13,
          weight: 500
        },
        bodyFont: {
          family: "'JetBrains Mono', monospace",
          size: 12
        }
      }
    },
    scales: {
      x: {
        grid: {
          color: colors.grid,
          drawBorder: false
        },
        ticks: {
          color: colors.text,
          font: {
            family: "'Inter', sans-serif",
            size: 11
          }
        }
      },
      y: {
        grid: {
          color: colors.grid,
          drawBorder: false
        },
        ticks: {
          color: colors.text,
          font: {
            family: "'JetBrains Mono', monospace",
            size: 11
          },
          callback: (value) => `${value}¬∞C`
        }
      }
    }
  };

  const humidityCtx = document.getElementById('humidity-chart').getContext('2d');
  humidityChart = new Chart(humidityCtx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {
          label: 'Dew Point',
          data: [],
          borderColor: colors.accent,
          backgroundColor: `${colors.accent}1a`,
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointRadius: 0,
          pointHoverRadius: 6,
          pointHoverBackgroundColor: colors.accent
        },
        {
          label: 'Current',
          data: [],
          borderColor: colors.accentSecondary,
          backgroundColor: colors.accentSecondary,
          borderWidth: 0,
          pointRadius: 8,
          pointHoverRadius: 10,
          showLine: false
        }
      ]
    },
    options: {
      ...chartOptions,
      scales: {
        ...chartOptions.scales,
        x: {
          ...chartOptions.scales.x,
          title: {
            display: true,
            text: 'Relative Humidity (%)',
            color: colors.text,
            font: {
              family: "'Inter', sans-serif",
              size: 11
            }
          }
        }
      }
    }
  });

  const temperatureCtx = document.getElementById('temperature-chart').getContext('2d');
  temperatureChart = new Chart(temperatureCtx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {
          label: 'Dew Point',
          data: [],
          borderColor: colors.accentSecondary,
          backgroundColor: `${colors.accentSecondary}1a`,
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointRadius: 0,
          pointHoverRadius: 6,
          pointHoverBackgroundColor: colors.accentSecondary
        },
        {
          label: 'Current',
          data: [],
          borderColor: colors.accent,
          backgroundColor: colors.accent,
          borderWidth: 0,
          pointRadius: 8,
          pointHoverRadius: 10,
          showLine: false
        }
      ]
    },
    options: {
      ...chartOptions,
      scales: {
        ...chartOptions.scales,
        x: {
          ...chartOptions.scales.x,
          title: {
            display: true,
            text: 'Temperature (¬∞C)',
            color: colors.text,
            font: {
              family: "'Inter', sans-serif",
              size: 11
            }
          }
        }
      }
    }
  });
}

function updateCharts(currentTemp, currentHumidity, currentDewPoint) {
  const humidityLabels = [];
  const humidityData = [];
  for (let rh = 10; rh <= 100; rh += 5) {
    humidityLabels.push(`${rh}%`);
    humidityData.push(calculateDewPoint(currentTemp, rh));
  }

  humidityChart.data.labels = humidityLabels;
  humidityChart.data.datasets[0].data = humidityData;

  const currentHumidityIndex = Math.round((currentHumidity - 10) / 5);
  const humidityMarkerData = new Array(humidityLabels.length).fill(null);
  if (currentHumidityIndex >= 0 && currentHumidityIndex < humidityLabels.length) {
    humidityMarkerData[currentHumidityIndex] = currentDewPoint;
  }
  humidityChart.data.datasets[1].data = humidityMarkerData;
  humidityChart.update('none');

  const tempLabels = [];
  const tempData = [];
  for (let t = -10; t <= 45; t += 5) {
    tempLabels.push(`${t}¬∞C`);
    tempData.push(calculateDewPoint(t, currentHumidity));
  }

  temperatureChart.data.labels = tempLabels;
  temperatureChart.data.datasets[0].data = tempData;

  const currentTempIndex = Math.round((currentTemp + 10) / 5);
  const tempMarkerData = new Array(tempLabels.length).fill(null);
  if (currentTempIndex >= 0 && currentTempIndex < tempLabels.length) {
    tempMarkerData[currentTempIndex] = currentDewPoint;
  }
  temperatureChart.data.datasets[1].data = tempMarkerData;
  temperatureChart.update('none');
}

function setupEventListeners() {
  temperatureSlider.addEventListener('input', updateDisplay);
  humiditySlider.addEventListener('input', updateDisplay);

  document.querySelectorAll('.btn-adjust').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.dataset.target;
      const delta = parseFloat(btn.dataset.delta);
      const slider = document.getElementById(targetId);
      const newValue = parseFloat(slider.value) + delta;
      const min = parseFloat(slider.min);
      const max = parseFloat(slider.max);
      slider.value = Math.max(min, Math.min(max, newValue));
      updateDisplay();
    });
  });

  document.addEventListener('keydown', (e) => {
    if (e.target.tagName === 'INPUT') return;

    switch(e.key) {
      case 'ArrowUp':
        e.preventDefault();
        temperatureSlider.value = Math.min(45, parseFloat(temperatureSlider.value) + 1);
        updateDisplay();
        break;
      case 'ArrowDown':
        e.preventDefault();
        temperatureSlider.value = Math.max(-10, parseFloat(temperatureSlider.value) - 1);
        updateDisplay();
        break;
      case 'ArrowRight':
        e.preventDefault();
        humiditySlider.value = Math.min(100, parseFloat(humiditySlider.value) + 2);
        updateDisplay();
        break;
      case 'ArrowLeft':
        e.preventDefault();
        humiditySlider.value = Math.max(1, parseFloat(humiditySlider.value) - 2);
        updateDisplay();
        break;
    }
  });
}

function loadChartJS() {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js';
    script.onload = resolve;
    script.onerror = reject;
    document.head.appendChild(script);
  });
}

async function init() {
  try {
    await loadChartJS();
    createCharts();
    setupEventListeners();
    updateDisplay();
  } catch (error) {
    console.error('Failed to load Chart.js:', error);
    document.querySelectorAll('.chart-container').forEach(el => {
      el.innerHTML = '<p style="color: var(--color-ink-secondary); text-align: center; padding: 2rem;">Charts unavailable</p>';
    });
    setupEventListeners();
    updateDisplay();
  }
}

init();
  </script>
</body>
</html>
